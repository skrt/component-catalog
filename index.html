<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Component Catalog</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    [x-cloak] { display: none !important; }
  </style>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">

<div x-data="catalog()" x-init="init()" x-cloak>

  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between gap-4">
      <h1 class="text-xl font-bold shrink-0">Component Catalog</h1>
      <div class="flex items-center gap-3 flex-1 max-w-xl">
        <div class="relative flex-1">
          <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input
            type="text"
            x-model="search"
            placeholder="Search components..."
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
        </div>
      </div>
      <span class="text-sm text-gray-500 shrink-0" x-text="filteredComponents.length + ' components'"></span>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 flex gap-6">

    <!-- Sidebar: Category Filter -->
    <aside class="w-48 shrink-0 hidden md:block">
      <nav class="sticky top-24 space-y-1">
        <button
          @click="activeCategory = null"
          :class="!activeCategory ? 'bg-blue-50 text-blue-700 font-medium' : 'text-gray-600 hover:bg-gray-100'"
          class="w-full text-left px-3 py-2 rounded-lg text-sm transition-colors"
        >All</button>
        <template x-for="cat in categories" :key="cat.id">
          <button
            @click="activeCategory = cat.id"
            :class="activeCategory === cat.id ? 'bg-blue-50 text-blue-700 font-medium' : 'text-gray-600 hover:bg-gray-100'"
            class="w-full text-left px-3 py-2 rounded-lg text-sm transition-colors"
            x-text="cat.label"
          ></button>
        </template>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 min-w-0">

      <!-- Mobile Category Tabs -->
      <div class="md:hidden flex gap-2 overflow-x-auto pb-4 mb-4 -mx-1 px-1">
        <button
          @click="activeCategory = null"
          :class="!activeCategory ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 border border-gray-300'"
          class="px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap shrink-0"
        >All</button>
        <template x-for="cat in categories" :key="cat.id">
          <button
            @click="activeCategory = cat.id"
            :class="activeCategory === cat.id ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 border border-gray-300'"
            class="px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap shrink-0"
            x-text="cat.label"
          ></button>
        </template>
      </div>

      <!-- Component List -->
      <div class="space-y-6">
        <template x-for="comp in filteredComponents" :key="comp.id">
          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">

            <!-- Component Header -->
            <div class="px-5 py-4 border-b border-gray-100 flex items-center justify-between gap-3">
              <div>
                <h2 class="text-base font-semibold" x-text="comp.name"></h2>
              </div>
              <div class="flex items-center gap-2 shrink-0">
                <span class="px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs font-medium" x-text="getCategoryLabel(comp.category)"></span>
                <template x-if="comp.figmaUrl">
                  <a :href="comp.figmaUrl" target="_blank" rel="noopener" class="inline-flex items-center gap-1 px-2.5 py-1 bg-purple-50 text-purple-700 rounded-md text-xs font-medium hover:bg-purple-100 transition-colors">
                    <svg class="w-3.5 h-3.5" viewBox="0 0 38 57" fill="currentColor"><path d="M19 28.5a9.5 9.5 0 1 1 19 0 9.5 9.5 0 0 1-19 0z"/><path d="M0 47.5A9.5 9.5 0 0 1 9.5 38H19v9.5a9.5 9.5 0 1 1-19 0z"/><path d="M19 0v19h9.5a9.5 9.5 0 1 0 0-19H19z"/><path d="M0 9.5A9.5 9.5 0 0 0 9.5 19H19V0H9.5A9.5 9.5 0 0 0 0 9.5z"/><path d="M0 28.5A9.5 9.5 0 0 0 9.5 38H19V19H9.5A9.5 9.5 0 0 0 0 28.5z"/></svg>
                    Figma
                  </a>
                </template>
              </div>
            </div>

            <!-- Tabs -->
            <div class="border-b border-gray-100">
              <div class="flex px-5 gap-4">
                <button
                  @click="setTab(comp.id, 'preview')"
                  :class="getTab(comp.id) === 'preview' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                  class="py-2.5 text-sm font-medium border-b-2 transition-colors"
                >Preview</button>
                <button
                  @click="setTab(comp.id, 'props')"
                  :class="getTab(comp.id) === 'props' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                  class="py-2.5 text-sm font-medium border-b-2 transition-colors"
                >Props</button>
                <template x-if="comp.tokens && comp.tokens.length > 0">
                  <button
                    @click="setTab(comp.id, 'tokens')"
                    :class="getTab(comp.id) === 'tokens' ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                    class="py-2.5 text-sm font-medium border-b-2 transition-colors"
                  >Tokens</button>
                </template>
              </div>
            </div>

            <!-- Tab Content -->
            <div>
              <!-- Preview Tab -->
              <div x-show="getTab(comp.id) === 'preview'" class="p-0">
                <iframe
                  :src="comp.preview + '?v=' + cacheKey"
                  class="w-full border-0"
                  :title="comp.name + ' preview'"
                  loading="lazy"
                  @load="resizeIframe($event.target)"
                  style="min-height: 100px;"
                ></iframe>
              </div>

              <!-- Props Tab -->
              <div x-show="getTab(comp.id) === 'props'" class="p-5">
                <table class="w-full text-sm">
                  <thead>
                    <tr class="text-left border-b border-gray-200">
                      <th class="pb-2 pr-4 font-semibold text-gray-700">Name</th>
                      <th class="pb-2 pr-4 font-semibold text-gray-700">Type</th>
                      <th class="pb-2 pr-4 font-semibold text-gray-700">Default</th>
                      <th class="pb-2 pr-4 font-semibold text-gray-700">Values</th>
                      <th class="pb-2 font-semibold text-gray-700">Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template x-for="prop in comp.props" :key="prop.name">
                      <tr class="border-b border-gray-50">
                        <td class="py-2 pr-4 font-mono text-blue-600 text-xs" x-text="prop.name"></td>
                        <td class="py-2 pr-4 text-gray-500" x-text="prop.type"></td>
                        <td class="py-2 pr-4 font-mono text-xs text-gray-500" x-text="prop.default"></td>
                        <td class="py-2 pr-4">
                          <template x-if="prop.values">
                            <div class="flex flex-wrap gap-1">
                              <template x-for="v in prop.values" :key="v">
                                <span class="px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded text-xs font-mono" x-text="v"></span>
                              </template>
                            </div>
                          </template>
                          <template x-if="!prop.values">
                            <span class="text-gray-400">-</span>
                          </template>
                        </td>
                        <td class="py-2 text-gray-600" x-text="prop.description"></td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>

              <!-- Tokens Tab -->
              <div x-show="getTab(comp.id) === 'tokens'" class="p-5">
                <template x-if="comp.tokens && comp.tokens.length > 0">
                  <div class="space-y-6">
                    <template x-for="group in comp.tokens" :key="group.category">
                      <div>
                        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3" x-text="group.category"></h3>
                        <div class="space-y-3">
                          <template x-for="item in group.items" :key="item.variant">
                            <div class="border border-gray-100 rounded-lg overflow-hidden">
                              <div class="bg-gray-50 px-3 py-1.5 border-b border-gray-100">
                                <span class="text-xs font-semibold text-gray-700" x-text="item.variant"></span>
                              </div>
                              <div class="divide-y divide-gray-50">
                                <template x-for="(tokenVal, tokenKey) in item.tokens" :key="tokenKey">
                                  <div class="flex items-center px-3 py-1.5">
                                    <span class="w-40 shrink-0 text-xs text-gray-500" x-text="tokenKey"></span>
                                    <code class="text-xs text-purple-700 bg-purple-50 px-2 py-0.5 rounded font-mono" x-text="tokenVal"></code>
                                  </div>
                                </template>
                              </div>
                            </div>
                          </template>
                        </div>
                      </div>
                    </template>
                  </div>
                </template>
              </div>
            </div>

          </div>
        </template>

        <!-- Empty State -->
        <div x-show="filteredComponents.length === 0" class="text-center py-16">
          <p class="text-gray-400 text-sm">No components found.</p>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
function catalog() {
  return {
    search: '',
    activeCategory: null,
    categories: [],
    components: [],
    tabs: {},
    cacheKey: Date.now(),

    async init() {
      try {
        const res = await fetch('components.json');
        const data = await res.json();
        this.categories = data.categories || [];
        this.components = data.components || [];
      } catch (e) {
        console.error('Failed to load components.json:', e);
      }
    },

    get filteredComponents() {
      return this.components.filter(c => {
        const matchesCategory = !this.activeCategory || c.category === this.activeCategory;
        const q = this.search.toLowerCase();
        const matchesSearch = !q
          || c.name.toLowerCase().includes(q)
          || c.description.toLowerCase().includes(q)
          || c.category.toLowerCase().includes(q);
        return matchesCategory && matchesSearch;
      });
    },

    getCategoryLabel(id) {
      const cat = this.categories.find(c => c.id === id);
      return cat ? cat.label : id;
    },

    getTab(compId) {
      return this.tabs[compId] || 'preview';
    },

    setTab(compId, tab) {
      this.tabs[compId] = tab;
    },

    resizeIframe(iframe) {
      const doResize = () => {
        try {
          const h = iframe.contentDocument.documentElement.scrollHeight;
          iframe.style.height = h + 'px';
        } catch (e) {
          iframe.style.height = '400px';
        }
      };
      doResize();
      setTimeout(doResize, 500);
      setTimeout(doResize, 1500);
      setTimeout(doResize, 3000);
    }
  };
}
</script>

</body>
</html>
